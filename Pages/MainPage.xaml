<?xml version="1.0" encoding="utf-8"?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  x:Class="UAUIngleza_plc.MainPage"
  Shell.FlyoutBehavior="Flyout"
  Title="UAU Ingleza - Inspeção de caixas"
  BackgroundColor="{StaticResource Background}"
>
  <Grid ColumnSpacing="0">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="4*" />
      <ColumnDefinition Width="3*" />
    </Grid.ColumnDefinitions>
    <!-- Coluna Esquerda: WebView da Câmera + Status de Conexão -->
    <Grid Grid.Column="0" RowSpacing="0">
      <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <!-- WebView da Câmera -->
      <Border Grid.Row="0" StrokeThickness="0" BackgroundColor="{StaticResource OffBlack}">
        <WebView x:Name="CameraWebView" BackgroundColor="{StaticResource OffBlack}" />
      </Border>
      <!-- Status de Conexão -->
      <Border
        Grid.Row="1"
        Background="{StaticResource SurfaceVariant}"
        Padding="14"
        StrokeThickness="1"
        Stroke="{StaticResource Gray300}"
      >
        <Grid ColumnSpacing="10">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>
          <Border
            Grid.Column="0"
            WidthRequest="18"
            HeightRequest="18"
            StrokeThickness="2"
            Stroke="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
            StrokeShape="RoundRectangle 9"
            Background="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
            VerticalOptions="Center"
          >
            <Border.Shadow>
              <Shadow
                Brush="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
                Radius="10"
                Opacity="0.6"
              />
            </Border.Shadow>
          </Border>
          <Label
            Grid.Column="1"
            Text="{Binding IsConnected, Converter={StaticResource BoolToStatusTextConverter}}"
            FontSize="13"
            FontAttributes="Bold"
            TextColor="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
            VerticalOptions="Center"
          />
        </Grid>
      </Border>
    </Grid>
    <!-- Menu Lateral -->
    <Border
      Grid.Column="1"
      Background="{StaticResource Surface}"
      StrokeThickness="2"
      Stroke="{StaticResource Gray200}"
    >
      <VerticalStackLayout Spacing="15" Padding="12">
        <!-- Picker de Receitas -->
        <Border
          BackgroundColor="{StaticResource SurfaceVariant}"
          StrokeShape="RoundRectangle 10"
          StrokeThickness="1"
          Stroke="{StaticResource Gray300}"
          Padding="4"
        >
          <Picker
            x:Name="RecipePicker"
            ItemsSource="{Binding RecipeList}"
            ItemDisplayBinding="{Binding Name}"
            SelectedItem="{Binding SelectedRecipe, Mode=TwoWay}"
            Title="Selecione uma receita"
            BackgroundColor="Transparent"
            TextColor="{StaticResource TextPrimary}"
            TitleColor="{StaticResource TextSecondary}"
            FontSize="14"
            FontAttributes="Bold"
            HeightRequest="50"
            Margin="8,0"
          />
        </Border>
        <!-- Divisor -->
        <BoxView
          HeightRequest="1"
          Color="{StaticResource Gray300}"
          HorizontalOptions="Fill"
          Margin="0,5,0,5"
        />
        <!-- Grid de Contadores -->
        <Grid ColumnSpacing="12" RowSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <!-- Caixas Boas -->
          <Border
            Grid.Column="0"
            Grid.Row="0"
            Background="{StaticResource CardBackground}"
            Padding="12"
            StrokeThickness="1"
            Stroke="{StaticResource Gray800Brush}"
            StrokeShape="RoundRectangle 12"
            Shadow="{Shadow Brush={StaticResource Success}, Offset='0,2', Radius=8, Opacity=0.3}"
          >
            <VerticalStackLayout Spacing="6">
              <Label
                Text="CAIXAS BOAS"
                FontSize="10"
                FontAttributes="Bold"
                TextColor="{StaticResource TextSecondary}"
                HorizontalOptions="Center"
              />
              <Label
                Text="{Binding CaixasBoas}"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                TextColor="{StaticResource Success}"
              />
            </VerticalStackLayout>
          </Border>
          <!-- Caixas Ruins -->
          <Border
            Grid.Column="1"
            Grid.Row="0"
            Background="{StaticResource CardBackground}"
            Padding="12"
            StrokeThickness="1"
            Stroke="{StaticResource Gray800Brush}"
            StrokeShape="RoundRectangle 12"
            Shadow="{Shadow Brush={StaticResource Danger}, Offset='0,2', Radius=8, Opacity=0.3}"
          >
            <VerticalStackLayout Spacing="6">
              <Label
                Text="CAIXAS RUINS"
                FontSize="10"
                FontAttributes="Bold"
                TextColor="{StaticResource TextSecondary}"
                HorizontalOptions="Center"
              />
              <Label
                Text="{Binding CaixasRejeitadas}"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                TextColor="{StaticResource Danger}"
              />
            </VerticalStackLayout>
          </Border>
          <!-- Total de Caixas -->
          <Border
            Grid.Column="0"
            Grid.Row="1"
            Grid.ColumnSpan="2"
            Background="{StaticResource CardBackground}"
            Padding="14"
            StrokeThickness="1"
            Stroke="{StaticResource Gray800Brush}"
            StrokeShape="RoundRectangle 12"
            Shadow="{Shadow Brush={StaticResource Primary}, Offset='0,2', Radius=8, Opacity=0.3}"
          >
            <VerticalStackLayout Spacing="6">
              <Label
                Text="TOTAL DE CAIXAS INSPECIONADAS"
                FontSize="11"
                FontAttributes="Bold"
                TextColor="{StaticResource TextSecondary}"
                HorizontalOptions="Center"
              />
              <Label
                Text="{Binding TotalCaixas}"
                FontSize="28"
                FontAttributes="Bold"
                HorizontalOptions="Center"
                TextColor="{StaticResource TextPrimary}"
              />
            </VerticalStackLayout>
          </Border>
        </Grid>
        <Button
          Text="RESETAR CONTADOR"
          Clicked="ResetCount"
          BackgroundColor="{StaticResource Warning}"
          TextColor="White"
          FontSize="13"
          FontAttributes="Bold"
          HeightRequest="50"
          CornerRadius="12"
          Margin="0,10,0,0"
          Shadow="{Shadow Brush={StaticResource Warning}, Offset='0,2', Radius=8, Opacity=0.3}"
        />
      </VerticalStackLayout>
    </Border>
    <Label Text="© 2025 Conecsa Automação e TI" FontAttributes="Bold" Margin="170, 370, 0, 0" />
  </Grid>
</ContentPage>
